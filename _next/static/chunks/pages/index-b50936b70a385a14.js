(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(t,e,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return o(6903)}])},6903:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return Q}});var n=o(5893),i=o(9008),a=o.n(i),s=o(2920),r=o(9537),d=o.n(r),l=o(7294),c=o(1664),u=o.n(c),h=o(5609),g=o.n(h);function m(t){let{myAccount:e,follows:o,authorId:i,setAuthor:a}=t;return(0,n.jsx)("div",{className:g()["follows-list"],children:(0,n.jsx)("ol",{start:o.length+1,reversed:!0,children:[e].concat(o).map(t=>(0,n.jsxs)("li",{className:t.id===i?g()["selected-author"]:"",children:["@",t.acct," ",t.display_name," ",t.id!==i&&(0,n.jsx)("button",{onClick:()=>a(t),children:"Select"})]},t.id))})})}let f=Intl.DateTimeFormat(void 0,{dateStyle:"short",timeStyle:"short",hourCycle:"h23"});function p(t){return f.format(new Date(t))}function _(t,e,o){return t.reblog?_(t.reblog,e,t):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:g()["toot-topbar"],children:[(0,n.jsx)("div",{className:g()["avatar-image"],children:(0,n.jsx)("a",{title:"Go to original",href:t.url,target:"_blank",rel:"noreferrer",children:(0,n.jsx)("img",{alt:t.account.username,src:t.account.avatar_static})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("a",{title:"Go to original",href:t.url,target:"_blank",rel:"noreferrer",className:g()["toot-author"],children:t.account.username}),(0,n.jsx)("br",{}),(0,n.jsxs)("small",{children:[p(t.created_at),e&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),e]}),o&&(0,n.jsxs)("span",{title:"Boosted on ".concat(p(o.created_at)),children:[" ","♻️"]})]})]})]}),(0,n.jsx)("div",{className:g()["dangerous-content"],dangerouslySetInnerHTML:{__html:t.content}}),t.media_attachments.length?(0,n.jsx)("div",{className:g()["attachments-list"],children:t.media_attachments.map(t=>(0,n.jsx)(w,{attachment:t},t.id))}):""]})}function x(t,e){return t.sort((t,o)=>t.account.id===o.account.id?t.created_at.localeCompare(o.created_at):t.account.id===e?-1:o.account.id===e?1:t.created_at.localeCompare(o.created_at))}function v(t){var e;let{progenitorId:o,trees:i,authorId:a,depth:s,siblingIdx:r,sectionNumbers:d}=t,c=L(i.id2status,o),u=[],h=t=>{let e=i.origIdToBoostId.get(t.id);return e?i.id2status.get(e):void 0},m=c;for(;m;){let f=Array.from(i.parent2childid.get(m.id)||[]).map(t=>L(i.id2status,t)),p=x(f.filter(t=>!0!==i.foldedIds.get(t.id)),a),w=f.length-p.length,j=w?"".concat(w," hidden ").concat(1===w?"reply":"replies"):"";p.length<=1?(u.push((0,n.jsx)("div",{className:g().toot,id:m.id,children:_(m,j,h(m))},m.id)),m=p[0]):(u.push((0,n.jsxs)(l.Fragment,{children:[(0,n.jsx)("div",{className:g().toot,id:m.id,children:_(m,j,h(m))},m.id),p.map((t,e)=>(0,n.jsx)(v,{progenitorId:t.id,trees:i,authorId:a,depth:s+1,siblingIdx:e+1,sectionNumbers:d.concat(e+1)},t.id+"/"+s))]},m.id)),m=void 0)}let y=i.parent2childid.get(null!==(e=i.child2parentid.get(c.id))&&void 0!==e?e:""),b=y?y.size:0,I=L(i.id2numDescendants,c.id);if(1===s)return(0,n.jsx)("div",{className:g().thread,children:u});let N=x(Array.from(y||[]).map(t=>L(i.id2status,t)),a),S=r&&r>1?(0,n.jsx)("a",{href:"#collapsible-".concat(N[r-1-1].id),title:"Previous sub-thread",children:"\uD83D\uDC48"}):"",C=r&&r<b?(0,n.jsx)("a",{href:"#collapsible-".concat(N[r+1-1].id),title:"Next sub-thread",children:"\uD83D\uDC49"}):"";return(0,n.jsxs)("details",{open:!0,className:g().thread,id:"collapsible-"+c.id,children:[(0,n.jsxs)("summary",{children:["\xa7",d.join("."),", reply #",null!=r?r:0," of ",b," (",I.shown+1," toot",I.shown?"s":"",")"," ",(0,n.jsx)("a",{href:"#".concat(c.in_reply_to_id),title:"Jump to parent of sub-thread",children:"\uD83D\uDC46"})," ",S," ",C]}),u]})}function w(t){let{attachment:e}=t;return(0,n.jsx)("div",{className:g()["media-container"],title:e.description||void 0,children:(0,n.jsxs)("a",{href:e.url,target:"_blank",rel:"noreferrer",children:[("video"===e.type||"gifv"===e.type)&&(0,n.jsx)("div",{className:g()["media-item-video-overlay"],children:(0,n.jsx)(j,{})}),(0,n.jsx)("img",{src:e.preview_url,alt:e.description||void 0,className:g()["media-item"],style:{aspectRatio:e.meta?e.meta.aspect:void 0}})]})})}function j(){return(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",children:(0,n.jsx)("path",{strokeWidth:"5",stroke:"white",d:"M371.7 238l-176-107c-15.8-8.8-35.7 2.5-35.7 21v208c0 18.4 19.8 29.8 35.7 21l176-101c16.4-9.1 16.4-32.8 0-42zM504 256C504 119 393 8 256 8S8 119 8 256s111 248 248 248 248-111 248-248zm-448 0c0-110.5 89.5-200 200-200s200 89.5 200 200-89.5 200-200 200S56 366.5 56 256z"})})}function y(){return{progenitorIds:new Map,foldedIds:new Map,id2status:new Map,child2parentid:new Map,parent2childid:new Map,id2numDescendants:new Map,origIdToBoostId:new Map}}async function b(t,e){let o=y(),n=s.Am.loading("Loading toots and threads…"),i=o.origIdToBoostId.size,a=o.progenitorIds.size,r=await t.getAccountStatuses(e.id,{limit:5});return await z(o,r.data,t,e.id),C(n,a,i,o),o}async function I(t,e){let o=y(),n=s.Am.loading("Loading toots and threads…"),i=o.origIdToBoostId.size,a=o.progenitorIds.size,r=await t.getAccountStatuses(e.id,{min_id:"0",limit:5});return await z(o,r.data,t,e.id),C(n,a,i,o),o}async function N(t,e,o,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,a=s.Am.loading("Loading toots and threads…"),r=o.origIdToBoostId.size,d=o.progenitorIds.size;for(;o.progenitorIds.size<d+n&&i>0;){let l=await t.getAccountStatuses(e.id,{min_id:o.maxContiguousId,limit:5});if(i--,0===l.data.length)break;await z(o,l.data,t,e.id)}return C(a,d,r,o),{...o}}async function S(t,e,o,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,a=s.Am.loading("Loading toots and threads…"),r=o.origIdToBoostId.size,d=o.progenitorIds.size;for(;o.progenitorIds.size<d+n&&i>0;){i--;let l=await t.getAccountStatuses(e.id,{max_id:o.minContiguousId,limit:5});if(0===l.data.length)break;await z(o,l.data,t,e.id)}return C(a,d,r,o),{...o}}function C(t,e,o,n){let i=n.progenitorIds.size-e,a=n.origIdToBoostId.size-o;s.Am.update(t,{type:"success",isLoading:!1,autoClose:1e3,render:"Loaded ".concat(i," thread").concat(1===i?"":"s",", ").concat(a," boost").concat(1===a?"":"s")})}function k(t){let{account:e,megalodon:o}=t,[i,a]=(0,l.useState)(()=>y()),[s,r]=(0,l.useState)(!1);(0,l.useEffect)(()=>{!async function(){let t=await b(o,e);a(t)}()},[o,e]),(0,l.useEffect)(()=>{window.trees=i},[i]);let d=(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:g()["hide-div"],children:(0,n.jsxs)("label",{htmlFor:"hide-boost-check",children:["Hide boosts?",(0,n.jsx)("input",{type:"checkbox",id:"hide-boost-check",checked:s,onChange(){r(t=>!t)}})]})})});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:g()["button-bar"],children:[(0,n.jsx)("button",{async onClick(){a(await b(o,e))},children:"Newest"}),(0,n.jsx)("button",{async onClick(){a(await N(o,e,i,1))},children:"Newer"}),d]}),Array.from(i.progenitorIds).sort((t,e)=>e[1].localeCompare(t[1])).filter(t=>{let[e]=t,o=L(i.id2status,e).reblog;return!o||(!s||!o)&&(!i.id2status.has(o.id)||!0===i.foldedIds.get(o.id))}).map(t=>{let[o]=t;return(0,n.jsx)(v,{trees:i,progenitorId:o,authorId:e.id,depth:1,sectionNumbers:[1]},o+"/0")}),(0,n.jsxs)("div",{className:g()["button-bar"],children:[(0,n.jsx)("button",{async onClick(){a(await S(o,e,i,1))},children:"Older"}),(0,n.jsx)("button",{async onClick(){a(await I(o,e))},children:"Oldest"}),d," "]})]})}function A(t){if(0===t.length)return[void 0,void 0];let e=t.values(),o=e.next().value,n=o;for(let i of e)o=0>i.localeCompare(o)?i:o,n=i.localeCompare(n)>0?i:n;return[o,n]}async function z(t,e,o,n){window.findDescendants=function t(e,o){let n=Array.from(e.parent2childid.get(o)||[]);return[o].concat(n.flatMap(o=>t(e,o)))};{let i=e.map(t=>t.id);void 0!==t.maxContiguousId&&i.concat(t.maxContiguousId),void 0!==t.minContiguousId&&i.concat(t.minContiguousId);let[a,s]=A(i);t.maxContiguousId=s,t.minContiguousId=a}for(let r of e){var d,l,c;let u;if(t.id2status.has(r.id))continue;if(r.in_reply_to_id){let h=await o.getStatusContext(r.id,{max_id:r.id});(u=h.data.ancestors[0])||(u=r)}else u=r;t.progenitorIds.set(u.id,"");let g=(await o.getStatusContext(u.id)).data,m=g.descendants;for(let f of(t.id2status.set(u.id,u),(null===(d=u.reblog)||void 0===d?void 0:d.id)&&t.origIdToBoostId.set(u.reblog.id,u.id),m)){t.id2status.set(f.id,f),(null===(l=f.reblog)||void 0===l?void 0:l.id)&&t.origIdToBoostId.set(f.reblog.id,f.id);let p=f.in_reply_to_id;if(!p)continue;let _=t.parent2childid.get(p)||new Set;_.add(f.id),t.parent2childid.set(p,_),null===(c=t.parent2childid.get(f.id))||void 0===c||c.has(f.id),t.child2parentid.set(f.id,p)}!function t(e,o,n){var i,a;let s=o.parent2childid.get(e);if(!s){let r=(null===(a=o.id2status.get(e))||void 0===a?void 0:a.account.id)===n;return o.id2numDescendants.set(e,{all:0,shown:0}),o.foldedIds.set(e,!r),o.progenitorIds.has(e)&&o.progenitorIds.set(e,e),{all:0,shown:0,authorFound:r,maxUnfoldedId:e}}let d=Array.from(s,e=>t(e,o,n)),l=D(d.map(t=>t.all)),c=D(d.map(t=>t.shown)),u=d.some(t=>t.authorFound)||(null===(i=o.id2status.get(e))||void 0===i?void 0:i.account.id)===n,h=s.size+l,g=D(Array.from(s,t=>+!o.foldedIds.get(t)))+c,m=d.filter(t=>t.authorFound).map(t=>t.maxUnfoldedId);u&&m.push(e);let f=A(m)[1]||"";return o.id2numDescendants.set(e,{all:h,shown:g}),o.foldedIds.set(e,!u),o.progenitorIds.has(e)&&o.progenitorIds.set(e,f),{all:h,shown:g,authorFound:u,maxUnfoldedId:f}}(u.id,t,n)}}function D(t){return 0===t.length?0:t.reduce((t,e)=>t+e,0)}function L(t,e){let o=t.get(e);if(void 0===o)throw Error("safeGet was unsafe");return o}var T=o(1163);let M="yoyogi-registration";function E(t){let{initialUrl:e,loggedIn:o,submit:i,switchServer:a}=t,[s,r]=(0,l.useState)(e),[d,c]=(0,l.useState)([]);return(0,l.useEffect)(()=>{s||c(G())},[s]),(0,l.useEffect)(()=>{r(e)},[e]),(0,n.jsx)("div",{className:o?g()["login-box0"]:g()["login-box"],children:o?(0,n.jsxs)(n.Fragment,{children:["Logged into ",s.split("//").at(-1)," ",(0,n.jsx)("button",{onClick(){a(),r("")},children:"Log out"})," "]}):(0,n.jsxs)(n.Fragment,{children:[d.length?(0,n.jsxs)("label",{htmlFor:"server-select",children:["Log in again?"," ",(0,n.jsxs)("select",{id:"server-select",onChange(t){r(t.target.value),i(t.target.value)},children:[(0,n.jsxs)("option",{value:"",children:["--Pick one of ",d.length," saved servers--"]},""),d.map(t=>(0,n.jsx)("option",{value:t,children:t},t))]})]}):"",(0,n.jsx)("form",{style:{display:"inline"},onSubmit(t){i(s),t.preventDefault()},children:(0,n.jsxs)("label",{htmlFor:"url-input",children:["Enter new Mastodon URL?",(0,n.jsx)("input",{id:"url-input",type:"url",placeholder:"https://octodon.social",onChange:t=>r(t.target.value),value:s})]})})," ",(0,n.jsx)("button",{onClick:()=>i(s),children:"Submit"})," ",(0,n.jsx)("button",{onClick(){a(),r(""),localStorage.clear(),c(G())},children:"Clear local data"})]})})}function F(t){let e=t.match(/\/+$/);return e&&e.index&&(t=t.slice(0,e.index)),t}let B=()=>F(window.location.origin+window.location.pathname);async function O(t,e){let o=await e.registerApp("Yoyogi",{scopes:["read","push"],website:"https://fasiha.github.io/yoyogi",redirect_uris:B()});return{url:t,version:1,client_id:o.client_id,client_secret:o.client_secret,authUrl:o.url||""}}async function U(t){let e=d()("mastodon",t),o=function(t){let e=localStorage.getItem("yoyogi-"+t);if(e)try{let o=JSON.parse(e);if(o.token)return o}catch(n){}}(t);if(o)return J(t,o.token);let n=await O(t,e);if(!n.authUrl){console.error("no URL");return}localStorage.setItem(M,JSON.stringify(n)),window.open(n.authUrl,"_self")}async function P(t,e){let o=d()("mastodon",t.url),n=await o.fetchAccessToken(t.client_id,t.client_secret,e,B());return console.log("got token"),function(t,e){let o=G(),n={version:1,urls:o.filter(e=>e!==t).concat(t)};localStorage.setItem(H,JSON.stringify(n)),localStorage.setItem("yoyogi-"+t,JSON.stringify({version:1,serverUrl:t,token:e}))}(t.url,n.access_token),J(t.url,n.access_token)}async function J(t,e){let o=d()("mastodon",t,e);try{let n=await o.verifyAccountCredentials();return{megalodon:o,account:n.data}}catch(i){console.error("Network error:",i);return}}async function R(t,e){let o=[];try{let n=await t.getAccountFollowing(e.id,{get_all:!0});o.push(...n.data)}catch(i){console.error("Network error:",i)}return o}function Y(){let[t,e]=(0,l.useState)(void 0),[o,i]=(0,l.useState)(void 0),[a,r]=(0,l.useState)([]),[d,c]=(0,l.useState)(void 0),[h,f]=(0,l.useState)(""),p=(0,T.useRouter)();(0,l.useEffect)(()=>{!async function(){let t=new URL(""+window.location).searchParams.get("code");if(t){let o=localStorage.getItem(M);if(!o){console.error("received a code in URL but no registration"),window.location.search="";return}try{let n=JSON.parse(o),a=await P(n,t);if(a){f(n.url),e(a.megalodon),i(a.account),c(a.account),r(await R(a.megalodon,a.account)),localStorage.removeItem(M),p.push("/",void 0,{shallow:!0});return}console.error("unable to verify")}catch(s){console.error("registration finalization error",s),localStorage.removeItem(M)}}}()},[p]);let _=()=>{e(void 0),i(void 0)};return(0,n.jsxs)("main",{className:g()["griddy-main"],children:[(0,n.jsxs)("div",{className:o?g().header:"",children:[(0,n.jsxs)("h1",{className:"header-title",children:["Yoyogi"," ",(0,n.jsx)("sup",{className:g()["sup-link"],children:(0,n.jsx)(u(),{href:"/about",as:"/yoyogi/about",children:"About"})})]}),(0,n.jsx)("div",{className:g()["login-div"],children:(0,n.jsx)(E,{loggedIn:!!o&&!!t,initialUrl:h,switchServer:_,async submit(t){let o=s.Am.loading("Logging in…");t=F(t);let n=await U(t);n&&(e(n.megalodon),i(n.account),c(n.account),s.Am.update(o,{render:"Loading follows…"}),r(await R(n.megalodon,n.account)),s.Am.update(o,{type:"success",isLoading:!1,autoClose:1e3,render:"Logged in!"}))}})})]}),o&&t&&d&&(0,n.jsxs)("div",{className:g()["follows-and-threads"],children:[(0,n.jsx)(m,{myAccount:o,follows:a,authorId:d.id,setAuthor:c}),(0,n.jsx)(k,{account:d,megalodon:t})]})]})}let H="yoyogi-urls";function G(){let t=localStorage.getItem(H);if(!t)return[];try{let e=JSON.parse(t);return e.urls}catch(o){return[]}}function Q(){return(0,n.jsxs)("div",{children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:"Yoyogi"}),(0,n.jsx)("meta",{name:"description",content:"Yoyogi: a Mastodon reader for folks who hate The Timeline"}),(0,n.jsx)("link",{rel:"icon",href:"data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>\uD83D\uDE82</text></svg>"})]}),(0,n.jsx)(Y,{}),(0,n.jsx)(s.Ix,{position:"top-center",autoClose:1e3,hideProgressBar:!0,pauseOnHover:!1,newestOnTop:!0,closeOnClick:!0})]})}o(4213)},5609:function(t){t.exports={"login-div":"components_login-div__38n9w","login-box":"components_login-box__6t_Nr","login-box0":"components_login-box0__kkEqg",header:"components_header___BPQd","follows-and-threads":"components_follows-and-threads__WnoZU","follows-list":"components_follows-list__bsDS4","selected-author":"components_selected-author__WNjN_","griddy-main":"components_griddy-main__ZzhYi","dangerous-content":"components_dangerous-content__ON0wc",thread:"components_thread__SE7mU",toot:"components_toot__VP_Hr","toot-author":"components_toot-author__R9grP","button-bar":"components_button-bar__McoQs","hide-div":"components_hide-div__1mz8o","toot-topbar":"components_toot-topbar__SISfQ","avatar-image":"components_avatar-image__gq0YM","attachments-list":"components_attachments-list__MfK_p","media-container":"components_media-container__np_UV","media-item-video-overlay":"components_media-item-video-overlay__jJPbT"}},1437:function(){},4675:function(){},6335:function(){},3662:function(){},6782:function(){},8137:function(){},4656:function(){}},function(t){t.O(0,[714,996,33,774,888,179],function(){return t(t.s=8312)}),_N_E=t.O()}]);